bus=function(t){this.opts=t||{},this.channels=[],this._state=t?t.defaultstate||"normal":"normal",this.debug=!1},bus.prototype.state=function(t){return t?(this._state=t,void this.publish("state",t)):this._state},bus.prototype.publish=function(t,s,e){e&&this.state(e),this.debug&&(console.log("--> bus.publish('"+t+"') state="+this._state),s&&console.dir(s));var n=this;(this.channels[t]||[]).map(function(t){t(s,n._state)})},bus.prototype.subscribe=function(t,s){return(this.channels[t]=this.channels[t]||[]).push(s),[t,s]},bus.prototype.unsubscribe=function(t){for(var s=this.channels[t[0]],e=s.length;e--;)s[e]===t[1]&&s.splice(e,1)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=bus:window.bus=bus;
